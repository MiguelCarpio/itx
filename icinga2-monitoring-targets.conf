/*
 * Icinga2 configuration for monitoring lab targets
 * Place this file in /etc/icinga2/conf.d/ inside the icinga2 container
 */

// Define the monitoring target host
object Host "monitoring-nginx" {
  import "generic-host"

  address = "monitoring-nginx"  // Docker container name (same network)

  vars.http_vhosts["http"] = {
    http_port = 80
    http_uri = "/"
  }
}

// HTTP Service check for Nginx (internal port 80)
object Service "http" {
  import "generic-service"

  host_name = "monitoring-nginx"
  check_command = "http"

  vars.http_port = 80  // Internal container port
  vars.http_uri = "/"
  vars.http_expect = "200"
}

// Alternative: Check specific content
object Service "http-content" {
  import "generic-service"

  host_name = "monitoring-nginx"
  check_command = "http"

  vars.http_port = 8081
  vars.http_uri = "/"
  vars.http_expect = "200"
  vars.http_string = "Nginx Monitoring Test Page"  // String to look for
}

// DNS Server check
object Host "monitoring-dns" {
  import "generic-host"
  address = "monitoring-dns"
}

object Service "dns" {
  import "generic-service"
  host_name = "monitoring-dns"
  check_command = "dns"

  vars.dns_lookup = "google.com"
  vars.dns_server = "monitoring-dns"
}

// Redis check
object Host "monitoring-redis" {
  import "generic-host"
  address = "monitoring-redis"
}

object Service "redis" {
  import "generic-service"
  host_name = "monitoring-redis"
  check_command = "redis"
}

// MariaDB check
object Host "monitoring-mariadb" {
  import "generic-host"
  address = "monitoring-mariadb"
}

object Service "mysql" {
  import "generic-service"
  host_name = "monitoring-mariadb"
  check_command = "mysql"

  vars.mysql_username = "root"
  vars.mysql_password = "mariapass"
  vars.mysql_port = 3306
}

// SMTP check
object Host "monitoring-smtp" {
  import "generic-host"
  address = "monitoring-smtp"
}

object Service "smtp" {
  import "generic-service"
  host_name = "monitoring-smtp"
  check_command = "smtp"

  vars.smtp_port = 1025
}
